import{_ as s}from"./s-empty.B89PqN2E.js";import{v as o,_ as t,j as e,f as a,w as i,k as l,p as n,t as c,l as d,F as u,m as r,u as f,s as g,B as m,g as p,i as _,C as b,q as k,D as y,A as I,d as x,c as w,o as v,r as S,e as h,z as j,ab as C}from"./index-B9abLD3F.js";import{_ as $}from"./su-swiper.STgNvKQ7.js";import{_ as A}from"./s-select-groupon-sku.CiHdIVxs.js";import{S as T}from"./s-layout.Bb9KgRKE.js";import{d as P,a as V,_ as N,b as H,c as z,e as D}from"./detail-content-card.C5jdIvzd.js";import{u as U,d as L,f as M}from"./useGoods.CNfLrev9.js";import{C as q}from"./combination.CfuZ54Qz.js";import{_ as B}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{S as F}from"./spu.Cby8Nr3S.js";import"./su-number-box.bg7F02ES.js";import"./favorite.BozBlweO.js";import"./comment-item.DUh4ouOD.js";import"./uni-rate.DQPzr5r4.js";import"./su-image.BhUL1nHk.js";import"./mp-html.zMPDqqPP.js";import"./index.CAehB1O5.js";const J=B({__name:"groupon-card-list",props:{modelValue:{type:Object,default(){}}},emits:["join"],setup(s,{emit:I}){const x=s,w=o({list:[]}),v=I;function S(s){const o=U(s);if(o.ms<=0)return"该团已解散";let t="剩余 ";return t+=`${o.h}时`,t+=`${o.m}分`,t+=`${o.s}秒`,t}return t((async()=>{const{data:s}=await q.getHeadCombinationRecordList(x.modelValue.id,0,10);w.list=s})),(s,o)=>{const t=_,I=b,x=k,h=y;return w.list.length>0?(e(),a(t,{key:0,class:"groupon-list detail-card ss-p-x-20"},{default:i((()=>[l(t,{class:"join-activity ss-flex ss-row-between ss-m-t-30"},{default:i((()=>[l(t,{class:""},{default:i((()=>[n("已有"+c(w.list.length)+"人参与活动",1)])),_:1}),l(I,{class:"cicon-forward"})])),_:1}),(e(!0),d(u,null,r(w.list,((s,o)=>(e(),a(t,{onClick:o=>f(g).$router.go("/pages/activity/groupon/detail",{id:s.id}),key:o,class:"ss-m-t-40 ss-flex ss-row-between border-bottom ss-p-b-30"},{default:i((()=>[l(t,{class:"ss-flex ss-col-center"},{default:i((()=>[l(x,{src:f(g).$url.cdn(s.avatar),class:"user-avatar"},null,8,["src"]),l(t,{class:"user-nickname ss-m-l-20 ss-line-1"},{default:i((()=>[n(c(s.nickname),1)])),_:2},1024)])),_:2},1024),l(t,{class:"ss-flex ss-col-center"},{default:i((()=>[l(t,{class:"ss-flex-col ss-col-bottom ss-m-r-20"},{default:i((()=>[l(t,{class:"title ss-flex ss-m-b-14"},{default:i((()=>[n(" 还差 "),l(t,{class:"num"},{default:i((()=>[n(c(s.userSize-s.userCount)+"人",1)])),_:2},1024),n(" 成团 ")])),_:2},1024),l(t,{class:"end-time"},{default:i((()=>[n(c(S(s.expireTime)),1)])),_:2},1024)])),_:2},1024),l(t,{class:""},{default:i((()=>[l(h,{class:"ss-reset-button go-btn",onClick:m((o=>function(s){v("join",s)}(s)),["stop"])},{default:i((()=>[n(" 去参团 ")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128))])),_:1})):p("",!0)}}},[["__scopeId","data-v-2ff60b94"]]),O=B({__name:"groupon",setup(t){I((s=>({"712ba4ba":f(r),"18015b70":f(m),"39223f54":f(b),"4b8b749c":f(B)})));const r=g.$url.css("/static/img/shop/goods/groupon-bg.png"),m=g.$url.css("/static/img/shop/goods/groupon-btn.png"),b=g.$url.css("/static/img/shop/goods/activity-btn-disabled.png"),B=g.$url.css("/static/img/shop/goods/groupon-tip-bg.png");x((()=>{}));const O=o({skeletonLoading:!0,goodsId:0,goodsInfo:{},goodsSwiper:[],showSelectSku:!1,selectedSku:{},activity:{},grouponId:0,grouponNum:0,grouponAction:"create",combinationHeadId:null}),E=w((()=>U(O.activity.endTime)));function G(s){O.selectedSku=s}function R(){O.showSelectSku=!1}function Z(){O.grouponAction="create",O.grouponId=0,O.showSelectSku=!0}function K(s){O.grouponAction="join",O.grouponId=s.activityId,O.combinationHeadId=s.id,O.grouponNum=s.userSize,O.showSelectSku=!0}function Q(s){g.$router.go("/pages/order/confirm",{data:JSON.stringify({order_type:"goods",combinationActivityId:O.activity.id,combinationHeadId:O.combinationHeadId,items:[{skuId:s.id,count:s.count}]})})}const W=w((()=>C(O.activity)?{}:g.$platform.share.getShareInfo({title:O.activity.name,image:g.$url.cdn(O.goodsInfo.picUrl),params:{page:"3",query:O.activity.id}},{type:"goods",title:O.activity.name,image:g.$url.cdn(O.goodsInfo.picUrl),price:M(O.goodsInfo.price),marketPrice:M(O.goodsInfo.marketPrice)})));return v((async s=>{if(!s.id)return void(O.goodsInfo=null);O.grouponId=s.id;const{code:o,data:t}=await q.getCombinationActivity(O.grouponId);O.activity=t;const{data:e}=await F.getSpuDetail(t.spuId);O.goodsId=e.id,e.price=t.products.reduce(((s,o)=>Math.min(s,o.combinationPrice||1/0)),1/0),e.skus.forEach((s=>{const o=t.products.find((o=>o.skuId===s.id));o?s.price=o.combinationPrice:s.stock=0})),O.skeletonLoading=!1,0===o?(O.goodsInfo=e,O.grouponNum=t.userSize,O.goodsSwiper=L(O.goodsInfo.sliderPicUrls)):O.goodsInfo=null})),(o,t)=>{const r=S(h("s-empty"),s),m=S(h("su-swiper"),$),b=_,I=k,x=S(h("s-select-groupon-sku"),A),w=y,v=S(h("s-layout"),T);return e(),a(v,{onShareAppMessage:W.value,navbar:"goods"},{default:i((()=>[l(P),O.skeletonLoading?(e(),a(V,{key:0})):null===O.goodsInfo||0!==O.activity.status||O.activity.endTime<(new Date).getTime()?(e(),a(r,{key:1,text:"活动不存在或已结束",icon:"/static/soldout-empty.png",showAction:"",actionText:"返回上一页",onClickAction:t[0]||(t[0]=s=>f(g).$router.back())})):(e(),d(u,{key:2},[l(b,{class:"detail-swiper-selector"},{default:i((()=>[l(m,{class:"ss-m-b-14",isPreview:"",list:O.goodsSwiper,dotStyle:"tag",imageMode:"widthFix",dotCur:"bg-mask-40",seizeHeight:750},null,8,["list"]),l(b,{class:"title-card detail-card ss-m-y-14 ss-m-x-20 ss-p-x-20 ss-p-y-34"},{default:i((()=>[l(b,{class:"ss-flex ss-row-between ss-m-b-60"},{default:i((()=>[l(b,null,{default:i((()=>[l(b,{class:"price-box ss-flex ss-col-bottom ss-m-b-18"},{default:i((()=>[l(b,{class:"price-text ss-m-r-16"},{default:i((()=>[n(c(f(M)(O.activity.price||O.goodsInfo.price)),1)])),_:1}),l(b,{class:"tig ss-flex ss-col-center"},{default:i((()=>[l(b,{class:"tig-icon ss-flex ss-col-center ss-row-center"},{default:i((()=>[l(b,{class:"groupon-tag"},{default:i((()=>[l(I,{src:f(g).$url.static("/static/img/shop/goods/groupon-tag.png")},null,8,["src"])])),_:1})])),_:1}),l(b,{class:"tig-title"},{default:i((()=>[n("拼团价")])),_:1})])),_:1})])),_:1}),l(b,{class:"ss-flex ss-row-between"},{default:i((()=>[O.goodsInfo.price?(e(),a(b,{key:0,class:"origin-price ss-flex ss-col-center"},{default:i((()=>[n(" 单买价： "),l(b,{class:"origin-price-text"},{default:i((()=>[n(c(f(M)(O.goodsInfo.marketPrice)),1)])),_:1})])),_:1})):p("",!0)])),_:1})])),_:1}),E.value.ms>0?(e(),a(b,{key:0,class:"countdown-box"},{default:i((()=>[l(b,{class:"countdown-title ss-m-b-20"},{default:i((()=>[n("距结束仅剩")])),_:1}),l(b,{class:"ss-flex countdown-time"},{default:i((()=>[l(b,{class:"ss-flex countdown-h"},{default:i((()=>[n(c(E.value.h),1)])),_:1}),l(b,{class:"ss-m-x-4"},{default:i((()=>[n(":")])),_:1}),l(b,{class:"countdown-num ss-flex ss-row-center"},{default:i((()=>[n(c(E.value.m),1)])),_:1}),l(b,{class:"ss-m-x-4"},{default:i((()=>[n(":")])),_:1}),l(b,{class:"countdown-num ss-flex ss-row-center"},{default:i((()=>[n(c(E.value.s),1)])),_:1})])),_:1})])),_:1})):(e(),a(b,{key:1,class:"countdown-title"},{default:i((()=>[n(" 活动已结束 ")])),_:1}))])),_:1}),l(b,{class:"title-text ss-line-2 ss-m-b-6"},{default:i((()=>[n(c(O.goodsInfo.name),1)])),_:1}),l(b,{class:"subtitle-text ss-line-1"},{default:i((()=>[n(c(O.goodsInfo.introduction),1)])),_:1})])),_:1}),l(b,{class:"detail-cell-card detail-card ss-flex-col"},{default:i((()=>[l(N,{sku:O.selectedSku,onClick:t[1]||(t[1]=s=>O.showSelectSku=!0)},null,8,["sku"])])),_:1}),l(J,{modelValue:O.activity,"onUpdate:modelValue":t[2]||(t[2]=s=>O.activity=s),onJoin:K},null,8,["modelValue"]),l(x,{show:O.showSelectSku,goodsInfo:O.goodsInfo,grouponAction:O.grouponAction,grouponNum:O.grouponNum,onBuy:Q,onChange:G,onClose:R},null,8,["show","goodsInfo","grouponAction","grouponNum"])])),_:1}),l(H,{class:"detail-comment-selector",goodsId:O.goodsId},null,8,["goodsId"]),l(z,{class:"detail-content-selector",content:O.goodsInfo.description},null,8,["content"]),l(D,{modelValue:O.goodsInfo,"onUpdate:modelValue":t[4]||(t[4]=s=>O.goodsInfo=s)},{default:i((()=>[l(b,{class:"buy-box ss-flex ss-col-center ss-p-r-20"},{default:i((()=>[l(w,{class:"ss-reset-button origin-price-btn ss-flex-col",onClick:t[3]||(t[3]=s=>f(g).$router.go("/pages/goods/index",{id:O.goodsInfo.id}))},{default:i((()=>[l(b,{class:"btn-price"},{default:i((()=>[n(c(f(M)(O.goodsInfo.marketPrice)),1)])),_:1}),l(b,null,{default:i((()=>[n("原价购买")])),_:1})])),_:1}),l(w,{class:j(["ss-reset-button btn-tox ss-flex-col",0===O.activity.status&&0!==O.goodsInfo.stock?"check-btn-box":"disabled-btn-box"]),onClick:Z,disabled:0===O.goodsInfo.stock||0!==O.activity.status},{default:i((()=>[l(b,{class:"btn-price"},{default:i((()=>[n(c(f(M)(O.selectedSku.price*O.selectedSku.count||O.activity.price*O.selectedSku.count||O.goodsInfo.price*O.selectedSku.count||O.goodsInfo.price)),1)])),_:1}),O.activity.startTime>(new Date).getTime()?(e(),a(b,{key:0},{default:i((()=>[n("未开始")])),_:1})):O.activity.endTime<=(new Date).getTime()?(e(),a(b,{key:1},{default:i((()=>[n("已结束")])),_:1})):(e(),a(b,{key:2},{default:i((()=>[0===O.goodsInfo.stock?(e(),a(b,{key:0},{default:i((()=>[n("已售罄")])),_:1})):(e(),a(b,{key:1},{default:i((()=>[n("立即开团")])),_:1}))])),_:1}))])),_:1},8,["class","disabled"])])),_:1})])),_:1},8,["modelValue"])],64))])),_:1},8,["onShareAppMessage"])}}},[["__scopeId","data-v-9f949af1"]]);export{O as default};
