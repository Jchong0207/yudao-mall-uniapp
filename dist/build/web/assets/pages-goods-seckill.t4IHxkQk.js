import{_ as s}from"./s-empty.B89PqN2E.js";import{j as e,f as t,w as o,k as l,p as a,t as i,y as c,i as n,A as d,s as u,d as r,v as f,c as m,U as p,o as g,r as k,e as _,u as b,ac as v,l as x,g as y,z as I,ad as w,F as S,ab as h,C as j,D as C}from"./index-B9abLD3F.js";import{_ as L}from"./su-swiper.STgNvKQ7.js";import{_ as T}from"./s-select-seckill-sku.CCfJRY3u.js";import{S as P}from"./s-layout.Bb9KgRKE.js";import{d as A,f as $,u as U}from"./useGoods.CNfLrev9.js";import{d as D,a as M,_ as V,b as E,c as R,e as z}from"./detail-content-card.C5jdIvzd.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{S as N}from"./seckill.BMmjSiyi.js";import{S as q}from"./spu.Cby8Nr3S.js";import{m as B}from"./min.NYZJvUqb.js";import"./su-number-box.bg7F02ES.js";import"./index.CAehB1O5.js";import"./favorite.BozBlweO.js";import"./comment-item.DUh4ouOD.js";import"./uni-rate.DQPzr5r4.js";import"./su-image.BhUL1nHk.js";import"./mp-html.zMPDqqPP.js";const G=F({__name:"detail-progress",props:{percent:{type:Number,default:0}},setup:s=>(d,u)=>{const r=n;return e(),t(r,{class:"ss-flex ss-col-center"},{default:o((()=>[l(r,{class:"progress-title ss-m-r-10"},{default:o((()=>[a(" 已抢"+i(s.percent)+"% ",1)])),_:1}),l(r,{class:"progress-box ss-flex ss-col-center"},{default:o((()=>[l(r,{class:"progerss-active",style:c({width:s.percent<10?"10%":s.percent+"%"})},null,8,["style"])])),_:1})])),_:1})}},[["__scopeId","data-v-58b2423c"]]),H=F({__name:"seckill",setup(c){d((s=>({"2f376668":b(F),"41393e6a":b(H),edfa8ca2:b(J),e6ca6844:b(O),"6c14258d":b(Z)})));const F=u.$url.css("/static/img/shop/goods/seckill-bg.png"),H=u.$url.css("/static/img/shop/goods/seckill-btn.png"),J=u.$url.css("/static/img/shop/goods/activity-btn-disabled.png"),O=u.$url.css("/static/img/shop/goods/seckill-tip-bg.png"),Z=u.$url.css("/static/img/shop/goods/groupon-tip-bg.png");r((()=>{}));const K=f({skeletonLoading:!0,goodsInfo:{},showSelectSku:!1,goodsSwiper:[],selectedSku:{},showModel:!1,total:0,percent:0,price:""}),Q=m((()=>U(ss.value.endTime)));function W(s){K.selectedSku=s}function X(s){u.$router.go("/pages/order/confirm",{data:JSON.stringify({order_type:"goods",buy_type:"seckill",seckillActivityId:ss.value.id,items:[{skuId:s.id,count:s.count}]})})}const Y=m((()=>h(b(ss))?{}:u.$platform.share.getShareInfo({title:ss.value.name,image:u.$url.cdn(K.goodsInfo.picUrl),params:{page:"4",query:ss.value.id}},{type:"goods",title:ss.value.name,image:u.$url.cdn(K.goodsInfo.picUrl),price:K.goodsInfo.price,marketPrice:K.goodsInfo.marketPrice}))),ss=p(),es=p(""),ts=async s=>{const{data:e}=await q.getSpuDetail(s);e.activity_type="seckill",K.goodsInfo=e,K.goodsSwiper=A(K.goodsInfo.sliderPicUrls),K.goodsInfo.price=B([K.goodsInfo.price,...ss.value.products.map((s=>s.seckillPrice))]),e.skus.forEach((s=>{const e=ss.value.products.find((e=>e.skuId===s.id));e?(s.price=e.seckillPrice,s.stock=Math.min(s.stock,e.stock)):s.stock=0,ss.value.totalLimitCount>0&&ss.value.singleLimitCount>0?s.limitCount=Math.min(ss.value.totalLimitCount,ss.value.singleLimitCount):ss.value.totalLimitCount>0?s.limitCount=ss.value.totalLimitCount:ss.value.singleLimitCount>0&&(s.limitCount=ss.value.singleLimitCount)})),K.skeletonLoading=!1};return g((s=>{s.id?(async s=>{const{data:e}=await N.getSeckillActivity(s);ss.value=e,es.value=v(ss.value.startTime,ss.value.endTime),K.percent=100-e.stock/e.totalStock*100,await ts(e.spuId)})(s.id):K.goodsInfo=null})),(c,d)=>{const r=k(_("s-empty"),s),f=k(_("su-swiper"),L),m=n,p=j,g=k(_("s-select-seckill-sku"),T),v=C,h=k(_("s-layout"),P);return e(),t(h,{onShareAppMessage:Y.value,navbar:"goods"},{default:o((()=>[l(D),K.skeletonLoading?(e(),t(M,{key:0})):null===K.goodsInfo||"seckill"!==K.goodsInfo.activity_type||Q.value.ms<=0?(e(),t(r,{key:1,text:"活动不存在或已结束",icon:"/static/soldout-empty.png",showAction:"",actionText:"再逛逛",actionUrl:"/pages/goods/list"})):(e(),x(S,{key:2},[l(m,{class:"detail-swiper-selector"},{default:o((()=>[l(f,{class:"ss-m-b-14",isPreview:"",list:K.goodsSwiper,dotStyle:"tag",imageMode:"widthFix",dotCur:"bg-mask-40",seizeHeight:750},null,8,["list"]),l(m,{class:"title-card ss-m-y-14 ss-m-x-20 ss-p-x-20 ss-p-y-34"},{default:o((()=>[l(m,{class:"price-box ss-flex ss-row-between ss-m-b-18"},{default:o((()=>[l(m,{class:"ss-flex"},{default:o((()=>[l(m,{class:"price-text ss-m-r-16"},{default:o((()=>[a(i(b($)(K.selectedSku.price||K.goodsInfo.price)),1)])),_:1}),l(m,{class:"tig ss-flex ss-col-center"},{default:o((()=>[l(m,{class:"tig-icon ss-flex ss-col-center ss-row-center"},{default:o((()=>[l(p,{class:"cicon-alarm"})])),_:1}),l(m,{class:"tig-title"},{default:o((()=>[a("秒杀价")])),_:1})])),_:1})])),_:1}),Q.value.ms>0?(e(),t(m,{key:0,class:"countdown-box"},{default:o((()=>[l(m,{class:"countdown-title ss-m-b-20"},{default:o((()=>[a("距结束仅剩")])),_:1}),l(m,{class:"ss-flex countdown-time"},{default:o((()=>[l(m,{class:"ss-flex countdown-h"},{default:o((()=>[a(i(Q.value.h),1)])),_:1}),l(m,{class:"ss-m-x-4"},{default:o((()=>[a(":")])),_:1}),l(m,{class:"countdown-num ss-flex ss-row-center"},{default:o((()=>[a(i(Q.value.m),1)])),_:1}),l(m,{class:"ss-m-x-4"},{default:o((()=>[a(":")])),_:1}),l(m,{class:"countdown-num ss-flex ss-row-center"},{default:o((()=>[a(i(Q.value.s),1)])),_:1})])),_:1})])),_:1})):(e(),t(m,{key:1,class:"countdown-title"},{default:o((()=>[a(" 活动已结束 ")])),_:1}))])),_:1}),l(m,{class:"ss-flex ss-row-between ss-m-b-60"},{default:o((()=>[K.goodsInfo.marketPrice?(e(),t(m,{key:0,class:"origin-price ss-flex ss-col-center"},{default:o((()=>[a(" 原价 "),l(m,{class:"origin-price-text"},{default:o((()=>[a(i(b($)(K.selectedSku.marketPrice||K.goodsInfo.marketPrice)),1)])),_:1})])),_:1})):y("",!0),l(G,{percent:K.percent},null,8,["percent"])])),_:1}),l(m,{class:"title-text ss-line-2 ss-m-b-6"},{default:o((()=>[a(i(K.goodsInfo.name||""),1)])),_:1}),l(m,{class:"subtitle-text ss-line-1"},{default:o((()=>[a(i(K.goodsInfo.introduction),1)])),_:1})])),_:1}),l(m,{class:"detail-cell-card detail-card ss-flex-col"},{default:o((()=>[l(V,{sku:K.selectedSku,onClick:d[0]||(d[0]=s=>K.showSelectSku=!0)},null,8,["sku"])])),_:1}),l(g,{modelValue:K.goodsInfo,"onUpdate:modelValue":d[1]||(d[1]=s=>K.goodsInfo=s),show:K.showSelectSku,"single-limit-count":ss.value.singleLimitCount,onBuy:X,onChange:W,onClose:d[2]||(d[2]=s=>K.showSelectSku=!1)},null,8,["modelValue","show","single-limit-count"])])),_:1}),l(E,{class:"detail-comment-selector",goodsId:K.goodsInfo.id},null,8,["goodsId"]),l(R,{class:"detail-content-selector",content:K.goodsInfo.description},null,8,["content"]),l(z,{modelValue:K.goodsInfo,"onUpdate:modelValue":d[5]||(d[5]=s=>K.goodsInfo=s)},{default:o((()=>[l(m,{class:"buy-box ss-flex ss-col-center ss-p-r-20"},{default:o((()=>[K.goodsInfo.marketPrice?(e(),t(v,{key:0,class:"ss-reset-button origin-price-btn ss-flex-col",onClick:d[3]||(d[3]=s=>b(u).$router.go("/pages/goods/index",{id:K.goodsInfo.id}))},{default:o((()=>[l(m,null,{default:o((()=>[l(m,{class:"btn-price"},{default:o((()=>[a(i(b($)(K.goodsInfo.marketPrice)),1)])),_:1}),l(m,null,{default:o((()=>[a("原价购买")])),_:1})])),_:1})])),_:1})):(e(),t(v,{key:1,class:"ss-reset-button origin-price-btn ss-flex-col"},{default:o((()=>[l(m,{class:I(["no-original",(0===K.goodsInfo.stock||(es.value,b(w).STARTED),"")])},{default:o((()=>[a(" 秒杀价 ")])),_:1},8,["class"])])),_:1})),l(v,{class:I(["ss-reset-button btn-box ss-flex-col",es.value===b(w).STARTED&&0!=K.goodsInfo.stock?"check-btn-box":"disabled-btn-box"]),onClick:d[4]||(d[4]=s=>K.showSelectSku=!0),disabled:0===K.goodsInfo.stock||es.value!==b(w).STARTED},{default:o((()=>[l(m,{class:"btn-price"},{default:o((()=>[a(i(b($)(K.goodsInfo.price)),1)])),_:1}),es.value===b(w).STARTED?(e(),t(m,{key:0},{default:o((()=>[0===K.goodsInfo.stock?(e(),t(m,{key:0},{default:o((()=>[a("已售罄")])),_:1})):(e(),t(m,{key:1},{default:o((()=>[a("立即秒杀")])),_:1}))])),_:1})):(e(),t(m,{key:1},{default:o((()=>[a(i(es.value),1)])),_:1}))])),_:1},8,["class","disabled"])])),_:1})])),_:1},8,["modelValue"])],64))])),_:1},8,["onShareAppMessage"])}}},[["__scopeId","data-v-48e35c44"]]);export{H as default};
