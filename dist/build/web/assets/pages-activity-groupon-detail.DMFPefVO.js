import{A as a,s as e,v as s,c as t,o,r as d,e as r,f as c,w as n,u as l,j as i,g as u,y as m,k as f,p,t as g,l as h,m as _,F as b,ab as y,a7 as k,i as w,C as x,q as R,D as v}from"./index-B9abLD3F.js";import{_ as I}from"./s-goods-item.C5iw1xli.js";import{_ as S}from"./s-select-groupon-sku.CiHdIVxs.js";import{_ as j}from"./s-empty.B89PqN2E.js";import{S as C}from"./s-layout.Bb9KgRKE.js";import{f as N,u as A}from"./useGoods.CNfLrev9.js";import{C as $}from"./combination.CfuZ54Qz.js";import{S as T}from"./spu.Cby8Nr3S.js";import{_ as P}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./su-number-box.bg7F02ES.js";import"./index.CAehB1O5.js";const z=P({__name:"detail",setup(P){a((a=>({"5b221410":l(z)})));const z=e.$url.css("/static/img/shop/user/withdraw_bg.png"),D=2*e.$platform.device.statusBarHeight,H=s({data:{},goodsId:0,goodsInfo:{},showSelectSku:!1,selectedSkuPrice:{},activity:{},grouponId:0,grouponNum:0,grouponAction:"create",combinationHeadId:null,loading:!0}),B=t((()=>{var a;return y(H.data)?{}:e.$platform.share.getShareInfo({title:H.data.headRecord.spuName,image:e.$url.cdn(H.data.headRecord.picUrl),desc:null==(a=H.data.goods)?void 0:a.subtitle,params:{page:"5",query:H.data.headRecord.id}},{type:"groupon",title:H.data.headRecord.spuName,image:e.$url.cdn(H.data.headRecord.picUrl),price:N(H.data.headRecord.combinationPrice)})}));function E(a){e.$router.go("/pages/order/detail",{id:a})}function M(){H.grouponAction="create",H.grouponId=0,H.showSelectSku=!0}function U(a){H.selectedSkuPrice=a}function q(a){e.$router.go("/pages/order/confirm",{data:JSON.stringify({order_type:"goods",combinationActivityId:H.activity.id,combinationHeadId:H.combinationHeadId,items:[{skuId:a.id,count:a.count}]})})}const F=t((()=>A(H.data.headRecord.expireTime)));function G(){k()}return o((a=>{!async function(a){const{code:e,data:s}=await $.getCombinationRecordDetail(a);if(0===e){H.data=s;const a=Number(H.data.headRecord.userSize-H.data.headRecord.userCount);H.remainNumber=a>0?a:0;const{data:e}=await $.getCombinationActivity(s.headRecord.activityId);H.activity=e,H.grouponNum=e.userSize;const{data:t}=await T.getSpuDetail(e.spuId);H.goodsId=t.id,e.products.forEach((a=>{t.price=Math.min(t.price,a.combinationPrice)})),H.goodsInfo=t,t.skus.forEach((a=>{const s=e.products.find((e=>e.skuId===a.id));s?a.price=s.combinationPrice:a.stock=0}))}else H.data=null;H.loading=!1}(a.id)})),(a,s)=>{const t=w,o=d(r("s-goods-item"),I),k=x,N=R,A=v,$=d(r("s-select-groupon-sku"),S),T=d(r("s-empty"),j),P=d(r("s-layout"),C);return i(),c(P,{title:"拼团详情",class:"detail-wrap",navbar:H.data&&!H.loading?"inner":"normal",onShareAppMessage:B.value},{default:n((()=>[H.loading?(i(),c(t,{key:0})):u("",!0),H.data&&!H.loading?(i(),c(t,{key:1},{default:n((()=>[H.data.headRecord?(i(),c(t,{key:0,class:"recharge-box",style:m([{marginTop:"-"+Number(D+88)+"rpx",paddingTop:Number(D+108)+"rpx"}])},{default:n((()=>[f(o,{class:"goods-box",img:H.data.headRecord.picUrl,title:H.data.headRecord.spuName,price:H.data.headRecord.combinationPrice,priceColor:"#E1212B",onClick:s[0]||(s[0]=a=>l(e).$router.go("/pages/goods/groupon",{id:H.data.headRecord.activityId})),style:m([{top:Number(D+108)+"rpx"}])},{groupon:n((()=>[f(t,{class:"ss-flex"},{default:n((()=>[f(t,{class:"sales-title"},{default:n((()=>[p(g(H.data.headRecord.userSize)+"人团",1)])),_:1}),f(t,{class:"num-title ss-m-l-20"},{default:n((()=>[p("已拼"+g(H.data.headRecord.userCount)+"件",1)])),_:1})])),_:1})])),_:1},8,["img","title","price","style"])])),_:1},8,["style"])):u("",!0),f(t,{class:"countdown-box detail-card ss-p-t-44 ss-flex-col ss-col-center"},{default:n((()=>[1===H.data.headRecord.status?(i(),c(t,{key:0},{default:n((()=>[H.data.orderId?(i(),c(t,{key:0},{default:n((()=>[f(t,{class:"countdown-title ss-flex"},{default:n((()=>[f(k,{class:"cicon-check-round"}),p(" 恭喜您~拼团成功 ")])),_:1})])),_:1})):(i(),c(t,{key:1},{default:n((()=>[f(t,{class:"countdown-title ss-flex"},{default:n((()=>[f(k,{class:"cicon-info"}),p(" 抱歉~该团已满员 ")])),_:1})])),_:1}))])),_:1})):u("",!0),2===H.data.headRecord.status?(i(),c(t,{key:1},{default:n((()=>[f(t,{class:"countdown-title ss-flex"},{default:n((()=>[f(k,{class:"cicon-info"}),p(" "+g(H.data.orderId?"拼团超时,已自动退款":"该团已解散"),1)])),_:1})])),_:1})):u("",!0),0===H.data.headRecord.status?(i(),c(t,{key:2},{default:n((()=>[H.data.headRecord.expireTime<=(new Date).getTime()?(i(),c(t,{key:0},{default:n((()=>[f(t,{class:"countdown-title ss-flex"},{default:n((()=>[f(k,{class:"cicon-info"}),p(" 拼团已结束,请关注下次活动 ")])),_:1})])),_:1})):(i(),c(t,{key:1,class:"countdown-title ss-flex"},{default:n((()=>[p(" 还差 "),f(t,{class:"num"},{default:n((()=>[p(g(H.data.headRecord.userSize-H.data.headRecord.userCount)+"人",1)])),_:1}),p(" 拼团成功 "),f(t,{class:"ss-flex countdown-time"},{default:n((()=>[f(t,{class:"countdown-h ss-flex ss-row-center"},{default:n((()=>[p(g(F.value.h),1)])),_:1}),f(t,{class:"ss-m-x-4"},{default:n((()=>[p(":")])),_:1}),f(t,{class:"countdown-num ss-flex ss-row-center"},{default:n((()=>[p(g(F.value.m),1)])),_:1}),f(t,{class:"ss-m-x-4"},{default:n((()=>[p(":")])),_:1}),f(t,{class:"countdown-num ss-flex ss-row-center"},{default:n((()=>[p(g(F.value.s),1)])),_:1})])),_:1})])),_:1}))])),_:1})):u("",!0),f(t,{class:"ss-m-t-60 ss-flex ss-flex-wrap ss-row-center"},{default:n((()=>[f(t,{class:"header-avatar ss-m-r-24 ss-m-b-20"},{default:n((()=>[f(N,{src:l(e).$url.cdn(H.data.headRecord.avatar),class:"avatar-img"},null,8,["src"]),f(t,{class:"header-tag ss-flex ss-col-center ss-row-center"},{default:n((()=>[p("团长")])),_:1})])),_:1}),(i(!0),h(b,null,_(H.data.memberRecords,(a=>(i(),c(t,{class:"header-avatar ss-m-r-24 ss-m-b-20",key:a.id},{default:n((()=>[f(N,{src:l(e).$url.cdn(a.avatar),class:"avatar-img"},null,8,["src"]),"1"==a.is_leader?(i(),c(t,{key:0,class:"header-tag ss-flex ss-col-center ss-row-center"},{default:n((()=>[p(" 团长 ")])),_:1})):u("",!0)])),_:2},1024)))),128)),(i(!0),h(b,null,_(H.remainNumber,(a=>(i(),c(t,{class:"default-avatar ss-m-r-24 ss-m-b-20",key:a},{default:n((()=>[f(N,{src:l(e).$url.static("/static/img/shop/avatar/unknown.png"),class:"avatar-img"},null,8,["src"])])),_:2},1024)))),128))])),_:1})])),_:1}),1===H.data.headRecord.status||2===H.data.headRecord.status?(i(),c(t,{key:1,class:"ss-m-t-40 ss-flex ss-row-center"},{default:n((()=>[H.data.orderId?(i(),c(A,{key:0,class:"ss-reset-button order-btn",onClick:s[1]||(s[1]=a=>E(H.data.orderId))},{default:n((()=>[p(" 查看订单 ")])),_:1})):(i(),c(A,{key:1,class:"ss-reset-button join-btn",onClick:M},{default:n((()=>[p(" 我要开团 ")])),_:1}))])),_:1})):u("",!0),0===H.data.headRecord.status?(i(),c(t,{key:2,class:"ss-m-t-40 ss-flex ss-row-center"},{default:n((()=>[H.data.headRecord.expireTime<=(new Date).getTime()?(i(),c(t,{key:0},{default:n((()=>[H.data.orderId?(i(),c(A,{key:0,class:"ss-reset-button join-btn",onClick:s[2]||(s[2]=a=>E(H.data.orderId))},{default:n((()=>[p(" 查看订单 ")])),_:1})):(i(),c(A,{key:1,class:"ss-reset-button disabled-btn",disabled:"",onClick:s[3]||(s[3]=a=>E(H.data.orderId))},{default:n((()=>[p(" 去参团 ")])),_:1}))])),_:1})):(i(),c(t,{key:1,class:"ss-flex ss-row-center"},{default:n((()=>[H.data.orderId?(i(),c(t,{key:0},{default:n((()=>[f(A,{class:"ss-reset-button join-btn",disabled:F.value.ms<=0,onClick:G},{default:n((()=>[p(" 邀请好友来拼团 ")])),_:1},8,["disabled"])])),_:1})):(i(),c(t,{key:1},{default:n((()=>[f(A,{class:"ss-reset-button join-btn",disabled:F.value.ms<=0,onClick:s[4]||(s[4]=a=>(H.grouponAction="join",H.grouponId=H.data.headRecord.activityId,H.combinationHeadId=H.data.headRecord.id,H.grouponNum=H.data.headRecord.userSize,void(H.showSelectSku=!0)))},{default:n((()=>[p(" 立即参团 ")])),_:1},8,["disabled"])])),_:1}))])),_:1}))])),_:1})):u("",!0),l(y)(H.goodsInfo)?u("",!0):(i(),c(t,{key:3},{default:n((()=>[f($,{show:H.showSelectSku,goodsInfo:H.goodsInfo,grouponAction:H.grouponAction,grouponNum:H.grouponNum,onBuy:q,onChange:U,onClose:s[5]||(s[5]=a=>H.showSelectSku=!1)},null,8,["show","goodsInfo","grouponAction","grouponNum"])])),_:1}))])),_:1})):u("",!0),H.data||H.loading?u("",!0):(i(),c(T,{key:2,icon:"/static/goods-empty.png"}))])),_:1},8,["navbar","onShareAppMessage"])}}},[["__scopeId","data-v-c821c48c"]]);export{z as default};
